<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Kokteyl Gecesi</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display&family=DM+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
  :root {
    --bg:#0b0b10;--card:#13131a;--card-hover:#1a1a23;--gold:#d4a843;--gold-light:#f0d78c;
    --gold-dim:#8a7234;--cream:#eae5da;--cream-mid:#b5ad9e;--cream-dim:#7a7468;--wine:#7a2038;
    --green:#4ade80;--red:#ef5555;--glow:rgba(212,168,67,.10);--border:rgba(212,168,67,.07);
    --border-h:rgba(212,168,67,.20);--border-s:rgba(212,168,67,.50);
  }
  *{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
  html{font-size:16px}
  body{background:var(--bg);color:var(--cream);font-family:'DM Sans',-apple-system,BlinkMacSystemFont,sans-serif;font-weight:400;min-height:100vh;min-height:100dvh;overflow-x:hidden;-webkit-font-smoothing:antialiased;line-height:1.5}
  body::after{content:'';position:fixed;inset:0;background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 512 512' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.75' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.03'/%3E%3C/svg%3E");pointer-events:none;z-index:100}
  .ambient{position:fixed;border-radius:50%;filter:blur(160px);pointer-events:none;z-index:0}
  .amb-1{width:420px;height:420px;top:-160px;left:-100px;background:var(--gold);opacity:.04}
  .amb-2{width:350px;height:350px;bottom:-120px;right:-60px;background:var(--wine);opacity:.05}
  .page{position:relative;z-index:1;width:100%;max-width:440px;margin:0 auto;padding:32px 16px 100px}
  .title{font-family:'DM Serif Display',serif;color:var(--gold);font-weight:400}
  .login-screen{min-height:100vh;min-height:100dvh;display:flex;align-items:center;justify-content:center;padding:24px 16px}
  .login-box{width:100%;max-width:360px;text-align:center;animation:fadeIn .8s ease}
  .login-icon{font-size:44px;margin-bottom:16px;display:block}
  .login-box h1{font-family:'DM Serif Display',serif;font-size:26px;color:var(--gold);margin-bottom:6px}
  .login-box .subtitle{font-size:15px;color:var(--cream-dim);margin-bottom:32px;line-height:1.5}
  .password-input{width:100%;padding:16px;background:var(--card);border:1px solid var(--border);border-radius:12px;color:var(--cream);font-family:'DM Sans',sans-serif;font-size:20px;font-weight:600;letter-spacing:5px;text-align:center;text-transform:uppercase;outline:none;transition:border-color .3s;margin-bottom:14px}
  .password-input::placeholder{letter-spacing:1px;font-size:15px;font-weight:400;color:var(--cream-dim);opacity:.6}
  .password-input:focus{border-color:var(--gold-dim)}
  .btn-gold{width:100%;padding:16px;background:linear-gradient(135deg,var(--gold-dim),var(--gold));border:none;border-radius:12px;color:var(--bg);font-family:'DM Sans',sans-serif;font-size:15px;font-weight:700;letter-spacing:.5px;cursor:pointer;transition:all .2s;min-height:52px}
  .btn-gold:active{transform:scale(.98);opacity:.9}
  .login-error{margin-top:14px;font-size:14px;color:var(--red);opacity:0;transition:opacity .3s}
  .login-error.show{opacity:1}
  .vote-screen{display:none}
  .header{text-align:center;margin-bottom:28px;animation:fadeDown .7s ease}
  .header-icon{font-size:32px;margin-bottom:8px;display:block}
  .greeting-banner{font-size:15px;font-weight:500;color:var(--gold-light);margin-bottom:14px;padding:10px 16px;background:rgba(212,168,67,.06);border:1px solid rgba(212,168,67,.12);border-radius:10px;animation:fadeIn .8s ease .2s both}
  .header h1{font-size:24px;line-height:1.3}
  .header p{font-size:15px;color:var(--cream-mid);margin-top:8px;line-height:1.55}
  .rule-badges{display:flex;flex-direction:column;gap:8px;margin-top:14px;align-items:center}
  .rule-badge{display:inline-block;padding:8px 16px;border:1px solid var(--gold-dim);border-radius:100px;font-size:13px;color:var(--gold-light);font-weight:500}
  .hint-badge{display:inline-block;padding:8px 16px;border:1px dashed var(--gold-dim);border-radius:100px;font-size:13px;color:var(--gold);font-weight:400;animation:pulse 2s ease-in-out infinite}
  @keyframes pulse{0%,100%{opacity:.7}50%{opacity:1}}
  .joke-btn-wrap{margin-top:14px;animation:fadeIn .6s ease .4s both}
  .joke-btn{width:100%;padding:14px 16px;background:var(--card);border:1px solid var(--wine);border-radius:12px;color:var(--cream);font-family:'DM Sans',sans-serif;font-size:14px;font-weight:600;cursor:pointer;transition:all .2s;min-height:48px}
  .joke-btn:active{transform:scale(.98);background:var(--card-hover)}
  .admin-bar{display:none;margin-top:14px;padding:10px 16px;background:rgba(212,168,67,.04);border:1px dashed var(--gold-dim);border-radius:10px;text-align:center}
  .admin-bar.show{display:block}
  .admin-bar label{font-size:13px;color:var(--cream-dim);margin-right:8px}
  .admin-bar select{padding:8px 12px;background:var(--bg);border:1px solid var(--border-h);border-radius:8px;color:var(--cream);font-family:'DM Sans',sans-serif;font-size:14px;outline:none}
  .counter{text-align:center;margin-bottom:20px;font-size:15px;color:var(--cream-dim);font-weight:400}
  .counter .num{color:var(--gold);font-weight:700;font-size:20px}
  .counter.done .num{color:var(--green)}
  .card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:20px;margin-bottom:12px;cursor:pointer;transition:all .25s ease;position:relative;animation:fadeUp .5s ease both;min-height:48px}
  .card:nth-child(1){animation-delay:.05s}.card:nth-child(2){animation-delay:.10s}.card:nth-child(3){animation-delay:.15s}.card:nth-child(4){animation-delay:.20s}.card:nth-child(5){animation-delay:.25s}
  .card:active{transform:scale(.98)}
  .card.selected{border-color:var(--border-s);background:linear-gradient(160deg,var(--card) 50%,rgba(212,168,67,.04) 100%);box-shadow:0 0 40px var(--glow)}
  .card.disabled{opacity:.25;pointer-events:none}
  .check{position:absolute;top:16px;right:16px;width:28px;height:28px;border-radius:50%;border:2px solid rgba(212,168,67,.15);display:flex;align-items:center;justify-content:center;transition:all .25s}
  .selected .check{background:var(--gold);border-color:var(--gold)}
  .check svg{width:14px;height:14px;stroke:var(--bg);stroke-width:3;fill:none;opacity:0;transition:opacity .2s}
  .selected .check svg{opacity:1}
  .card-name{font-family:'DM Serif Display',serif;font-size:21px;color:var(--gold-light);margin-bottom:3px;padding-right:44px;line-height:1.3}
  .card-vibe{font-size:12px;color:var(--cream-dim);text-transform:uppercase;letter-spacing:1.2px;font-weight:600;margin-bottom:12px}
  .ingredients{display:flex;flex-wrap:wrap;gap:6px;margin-bottom:8px}
  .ing-tag{padding:6px 12px;background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.07);border-radius:100px;font-size:13px;color:var(--cream)}
  .surprise-tags{display:flex;gap:6px;flex-wrap:wrap}
  .surprise-tag{padding:6px 12px;background:rgba(212,168,67,.06);border:1px dashed var(--gold-dim);border-radius:100px;font-size:13px;color:var(--gold);font-weight:500;cursor:pointer;transition:all .2s;min-height:34px;display:flex;align-items:center}
  .surprise-tag:active{background:rgba(212,168,67,.15)}
  .garnish{margin-top:10px;font-size:13px;color:var(--cream-dim);font-style:italic;opacity:.6}
  .submit-wrap{margin-top:28px;animation:fadeUp .5s ease .4s both}
  .submit-btn{width:100%;padding:18px;background:linear-gradient(135deg,var(--gold-dim) 0%,var(--gold) 100%);border:none;border-radius:14px;color:var(--bg);font-family:'DM Sans',sans-serif;font-size:16px;font-weight:700;cursor:pointer;transition:all .2s;opacity:.25;pointer-events:none;min-height:56px}
  .submit-btn.active{opacity:1;pointer-events:auto}
  .submit-btn.active:active{transform:scale(.98)}
  .submit-btn.sending{opacity:.5;pointer-events:none}
  .success-screen{display:none;min-height:100vh;min-height:100dvh;align-items:center;justify-content:center;text-align:center;padding:24px 16px}
  .success-screen .icon{font-size:56px;margin-bottom:16px;display:block;animation:popIn .5s ease}
  .success-screen h1{font-family:'DM Serif Display',serif;font-size:26px;color:var(--gold);margin-bottom:10px}
  .success-screen p{font-size:15px;color:var(--cream-mid);line-height:1.6}
  .chosen-list{margin-top:20px;text-align:left;max-width:280px;margin-left:auto;margin-right:auto}
  .chosen-item{padding:12px 16px;background:var(--card);border:1px solid var(--border);border-radius:10px;margin-bottom:8px;font-family:'DM Serif Display',serif;font-size:17px;color:var(--gold-light)}
  .modal-overlay,.confirm-overlay,.joke-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.85);z-index:50;align-items:center;justify-content:center;padding:16px}
  .modal-overlay.show,.confirm-overlay.show,.joke-overlay.show{display:flex}
  .confirm-overlay{z-index:55}
  .joke-overlay{z-index:52}
  .modal,.confirm-box,.joke-box{background:var(--card);border:1px solid var(--border-h);border-radius:16px;padding:24px 20px;max-width:360px;width:100%;text-align:center;animation:fadeUp .3s ease}
  .confirm-box{padding:28px 20px}
  .modal h3,.joke-box h3{font-family:'DM Serif Display',serif;font-size:20px;color:var(--gold);margin-bottom:6px}
  .modal .quiz-hint{font-size:13px;color:var(--cream-dim);margin-bottom:16px}
  .modal .quiz-q{font-size:16px;color:var(--cream);line-height:1.55;margin-bottom:20px;font-weight:500}
  .modal .quiz-input{width:100%;padding:14px 16px;background:var(--bg);border:1px solid var(--border);border-radius:10px;color:var(--cream);font-family:'DM Sans',sans-serif;font-size:16px;text-align:center;outline:none;margin-bottom:12px;min-height:48px}
  .modal .quiz-input:focus{border-color:var(--gold-dim)}
  .modal .quiz-submit{width:100%;padding:14px;background:linear-gradient(135deg,var(--gold-dim),var(--gold));border:none;border-radius:10px;color:var(--bg);font-family:'DM Sans',sans-serif;font-size:15px;font-weight:700;cursor:pointer;min-height:48px}
  .modal .quiz-result{margin-top:16px;font-size:14px;line-height:1.5;display:none;font-weight:500}
  .modal .quiz-result.wrong{color:var(--red);display:block}
  .modal .quiz-result.busted{color:var(--gold);display:block}
  .modal .modal-close,.joke-box .joke-close{margin-top:14px;padding:10px 24px;background:none;border:1px solid var(--border);border-radius:8px;color:var(--cream-dim);font-family:'DM Sans',sans-serif;font-size:14px;cursor:pointer;min-height:42px}
  .confirm-box .confirm-icon{font-size:36px;margin-bottom:12px;display:block}
  .confirm-box .confirm-text{font-size:16px;color:var(--cream);line-height:1.6;margin-bottom:20px;font-weight:500}
  .confirm-box .confirm-btn{width:100%;padding:16px;background:linear-gradient(135deg,var(--gold-dim),var(--gold));border:none;border-radius:12px;color:var(--bg);font-family:'DM Sans',sans-serif;font-size:15px;font-weight:700;cursor:pointer;min-height:52px;margin-bottom:10px}
  .confirm-box .confirm-cancel{width:100%;padding:14px;background:none;border:1px solid var(--border);border-radius:12px;color:var(--cream-dim);font-family:'DM Sans',sans-serif;font-size:14px;cursor:pointer;min-height:48px}
  .joke-box h3{margin-bottom:12px}
  .joke-box p{font-size:14px;color:var(--cream-mid);line-height:1.7;text-align:left;margin-bottom:16px}
  .joke-box img{width:100%;border-radius:10px;margin-bottom:12px}
  .joke-box .joke-title{font-size:16px;color:var(--green);font-weight:600;margin-bottom:12px}
  #cameraVideo{width:100%;border-radius:10px;margin-bottom:12px;display:none}
  @keyframes fadeIn{from{opacity:0}to{opacity:1}}
  @keyframes fadeDown{from{opacity:0;transform:translateY(-16px)}to{opacity:1;transform:translateY(0)}}
  @keyframes fadeUp{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)}}
  @keyframes popIn{0%{transform:scale(.5);opacity:0}50%{transform:scale(1.08)}100%{transform:scale(1);opacity:1}}
  @keyframes shake{0%,100%{transform:translateX(0)}20%{transform:translateX(-6px)}40%{transform:translateX(6px)}60%{transform:translateX(-4px)}80%{transform:translateX(4px)}}
  .shake{animation:shake .4s ease}
</style>
</head>
<body>
<div class="ambient amb-1"></div>
<div class="ambient amb-2"></div>

<!-- LOGIN -->
<div class="login-screen" id="loginScreen">
  <div class="login-box">
    <span class="login-icon">ü•É</span>
    <h1>Kokteyl Gecesi</h1>
    <p class="subtitle">Sana √∂zel ≈üifreni gir, oylamaya katƒ±l</p>
    <input type="text" class="password-input" id="passInput" placeholder="≈ûifre" autocomplete="off" autocapitalize="characters" spellcheck="false">
    <button class="btn-gold" onclick="handleLogin()">Gƒ∞Rƒ∞≈û YAP</button>
    <p class="login-error" id="loginError"></p>
  </div>
</div>

<!-- VOTE -->
<div class="vote-screen" id="voteScreen">
  <div class="page">
    <div class="header">
      <span class="header-icon">üç∏</span>
      <div class="greeting-banner" id="greetingText"></div>
      <div id="jokeBtnArea"></div>
      <div class="admin-bar" id="adminBar">
        <label>üëÅ √ñnizleme:</label>
        <select id="adminSelect" onchange="adminPreview(this.value)">
          <option value="">Kendi g√∂r√ºn√ºm√ºm</option>
          <option value="ARAP">Uygur (ARAP)</option>
          <option value="TAPULU">Ufuk (TAPULU)</option>
          <option value="MDMA">A.H.T.T (MDMA)</option>
          <option value="MGAVM">MTK (MGAVM)</option>
        </select>
      </div>
      <h1 class="title">Viski Gecesi Men√ºs√º</h1>
      <p>Bu sefer viski bazlƒ± 5 kokteyl hazƒ±rladƒ±m. En beƒüendiƒüin 3 tanesini se√ß!</p>
      <div class="rule-badges">
        <span class="rule-badge">üîí Her kokteylde 2 s√ºrpriz malzeme var</span>
        <span class="hint-badge">üëÜ S√ºrprizlere dokun, soruyu bil, malzemeyi √∂ƒüren!</span>
      </div>
    </div>
    <div class="counter" id="counter"><span class="num" id="countNum">0</span> / 3 se√ßildi</div>
    <div id="cardList"></div>
    <div class="submit-wrap">
      <button class="submit-btn" id="submitBtn" onclick="handleSubmit()">OYUMU G√ñNDER</button>
    </div>
  </div>
</div>

<!-- SUCCESS -->
<div class="success-screen" id="successScreen">
  <div>
    <span class="icon">üéâ</span>
    <h1 class="title">Oyun Kaydedildi!</h1>
    <p>Te≈üekk√ºrler, se√ßimlerin iletildi.<br>Kokteyl gecesinde g√∂r√º≈ü√ºr√ºz!</p>
    <div class="chosen-list" id="chosenList"></div>
  </div>
</div>

<!-- CONFIRM MODAL -->
<div class="confirm-overlay" id="confirmModal">
  <div class="confirm-box">
    <span class="confirm-icon" id="confirmIcon"></span>
    <p class="confirm-text" id="confirmText"></p>
    <video id="cameraVideo" autoplay playsinline muted></video>
    <button class="confirm-btn" id="confirmBtn"></button>
    <button class="confirm-cancel" onclick="closeConfirm()">Vazge√ß</button>
  </div>
</div>

<!-- JOKE POPUP -->
<div class="joke-overlay" id="jokeModal">
  <div class="joke-box">
    <h3 id="jokeTitle"></h3>
    <p id="jokeContent"></p>
    <img id="jokeImg" style="display:none">
    <div id="jokeTitleText" class="joke-title" style="display:none"></div>
    <button class="joke-close" onclick="document.getElementById('jokeModal').classList.remove('show')">Kapat</button>
  </div>
</div>

<!-- QUIZ MODAL -->
<div class="modal-overlay" id="quizModal">
  <div class="modal">
    <h3>üîí S√ºrpriz Kilidi</h3>
    <p class="quiz-hint">Soruyu doƒüru cevapla, s√ºrpriz malzemeyi √∂ƒüren</p>
    <p class="quiz-q" id="quizQuestion"></p>
    <input type="text" class="quiz-input" id="quizInput" placeholder="Cevabƒ±nƒ± yaz..." autocomplete="off" inputmode="text">
    <button class="quiz-submit" onclick="checkQuiz()">CEVAPLA</button>
    <div class="quiz-result" id="quizResult"></div>
    <button class="modal-close" onclick="closeQuiz()">Kapat</button>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
<script>
const EMAILJS_PUBLIC_KEY='DDJeUgA08efhrrIPp';
const EMAILJS_SERVICE_ID='service_vkb7jry';
const EMAILJS_TEMPLATE_ID='template_cohm3z2';
const IMGBB_API_KEY='44ab2a4be03540de597daba44674eee4';

const PASSWORDS={
  'ARAP':{name:'Uygur',greeting:'Ho≈ü geldiniz AQ uyguru, buyrun i√ßeri, size √∂zel tarihsel bilgileri almayƒ± unutmayƒ±nƒ±z üé©',admin:false},
  'TAPULU':{name:'Ufuk',greeting:'Ho≈ü geldiniz Ufuk DOST, tapunuzu almayƒ± unutmayƒ±nƒ±z ü•Ç',admin:false},
  'MDMA':{name:'A.H.T.T',greeting:'Ho≈ü geldin A.H.T.T, k√ºndeni atmayƒ± unutma üç∏',admin:false},
  'MGAVM':{name:'MTK',greeting:'Ho≈ü geldiniz MTK Bey, gecenin yƒ±ldƒ±zƒ± sizsiniz. Elma √ßekirdeƒüinizi almayƒ± unutmayƒ±nƒ±z. ‚ú®',admin:false},
  'NAMUSSUZ':{name:'Patron',greeting:'Ho≈ü geldin Patron, sistem senin emrinde üîß',admin:true}
};

const JOKE_BUTTONS={
  'ARAP':{label:'üìú Araplara √ñzel Bilgiler',type:'popup',title:'Araplara √ñzel Tarihsel Bilgiler',content:'Arap uygarlƒ±ƒüƒ±, M.√ñ. 3. y√ºzyƒ±ldan itibaren Arap Yarƒ±madasƒ±\'nda geli≈ümi≈ü k√∂kl√º bir medeniyettir. Nabatlƒ±lar Petra\'yƒ± in≈üa ederek ticaret yollarƒ±nƒ±n hakimi olmu≈ü, 8. y√ºzyƒ±lda Abbasi Halifeliƒüi d√∂neminde Baƒüdat d√ºnyanƒ±n en b√ºy√ºk bilim ve k√ºlt√ºr merkezi haline gelmi≈ütir. Cebir, algoritma, optik ve tƒ±p alanlarƒ±nda √ßƒ±ƒüƒ±r a√ßan √ßalƒ±≈ümalar bu d√∂nemde yapƒ±lmƒ±≈ütƒ±r. ƒ∞bn-i Sina\'nƒ±n Kanun fi\'t-Tƒ±b eseri y√ºzyƒ±llarca Avrupa\'da ders kitabƒ± olarak kullanƒ±lmƒ±≈ütƒ±r.\n\nNot: Bu bilgiler tamamen ger√ßektir ve hi√ßbir ≈üekilde ≈üaka deƒüildir. ƒ∞yi oylamalar Uygur Bey. üé©'},
  'TAPULU':{label:'üìã Tapumu Al',type:'download',url:'https://enyenikonutprojeleri.com/wp-content/uploads/2024/08/tapu-kayit-ornegi-835x467.jpg'},
  'MDMA':{label:'üî• Haftalƒ±k K√ºndemi At',type:'image_popup',title:'Haftalƒ±k K√ºndeniz Tamamlandƒ± ‚úÖ',img:'https://image.milimaj.com/i/milliyet/75/869x477/6312007e86b245372450d0af.jpg'},
  'MGAVM':{label:'üçé Elma √áekirdeƒüimi Al',type:'download',url:'https://image.hurimg.com/i/hurriyet/90/0x0/607029b07152d823d02c0cc1.jpg'}
};

function getUsed(){try{return JSON.parse(localStorage.getItem('kg_used')||'[]')}catch{return[]}}
function setUsed(p){const u=getUsed();if(!u.includes(p)){u.push(p);localStorage.setItem('kg_used',JSON.stringify(u))}}

let currentVoter='',currentPass='',isAdmin=false;

const BUSTED='Aynen kanka cidden √ßok iyi yapay zeka kullanƒ±yorsun. S√ºrpriz dediysek s√ºrpriz ü§ñ';

const cocktails=[
  {id:'haysiyetsiz',name:'Haysiyetsiz',vibe:'Dumanlƒ± ¬∑ Tatlƒ± ¬∑ Otsu',visible:['K√∂zlenmi≈ü pƒ±rasa','Bal','Limon','Soda'],secrets:['Armut','Ada√ßayƒ±'],garnish:'K√∂zlenmi≈ü pƒ±rasa halkasƒ± & armut dilimi ile servis edilir',questions:[{q:'Fermat\'ƒ±n Son Teoremi\'ni kanƒ±tlayan matematik√ßinin soyadƒ± nedir?',a:'wiles'},{q:'Riemann Hipotezi hangi matematik dalƒ±yla ilgilidir?',a:'analiz'}]},
  {id:'edepsiz',name:'Edepsiz',vibe:'Baharatlƒ± ¬∑ Ek≈üi ¬∑ Cesur',visible:['K√∂zlenmi≈ü kƒ±rmƒ±zƒ± biber','Bal','Limon','Soda'],secrets:['Zencefil','Nar'],garnish:'Biber dilimi & limon kabuƒüu ile servis edilir',questions:[{q:'Poincar√© Varsayƒ±mƒ±\'nƒ± kanƒ±tlayƒ±p Fields Madalyasƒ±\'nƒ± reddeden matematik√ßinin soyadƒ± nedir?',a:'perelman'},{q:'Hilbert\'in 1900\'de sunduƒüu √ºnl√º √ß√∂z√ºlmemi≈ü problemler listesinde ka√ß problem vardƒ±?',a:'23'}]},
  {id:'yuzsuz',name:'Y√ºzs√ºz',vibe:'Kremamsƒ± ¬∑ Sƒ±cak ¬∑ Yoƒüun',visible:['Tahin','Bal','Limon'],secrets:['Muz','Tar√ßƒ±n'],garnish:'Tahin √ßizgisi & bal damlasƒ± ile servis edilir',questions:[{q:'G√∂del\'in Eksiklik Teoremi hangi alanda devrim yarattƒ±?',a:'mantƒ±k'},{q:'Collatz Varsayƒ±mƒ±\'nda ba≈ülangƒ±√ß sayƒ±sƒ± tek ise hangi i≈ülem yapƒ±lƒ±r?',a:'3n+1'}]},
  {id:'arsiz',name:'Arsƒ±z',vibe:'Toprak ¬∑ Ek≈üi ¬∑ Dumanlƒ±',visible:['Pancar','Portakal','Limon','Soda'],secrets:['Yakƒ±lmƒ±≈ü biberiye','Ak√ßaaƒüa√ß ≈üurubu'],garnish:'Portakal dilimi & pancar ≈üeridi ile servis edilir',questions:[{q:'D√∂rt Renk Teoremi\'ne g√∂re herhangi bir harita en az ka√ß renkle boyanabilir?',a:'4'},{q:'Cantor\'un √ßaprazlama kanƒ±tƒ± neyin sayƒ±lamaz olduƒüunu g√∂sterir?',a:'reel'}]},
  {id:'terbiyesiz',name:'Terbiyesiz',vibe:'Kremamsƒ± ¬∑ Taze ¬∑ Meyveli',visible:['Avokado','B√∂ƒü√ºrtlen','Limon','Soda'],secrets:['Nane','Bal'],garnish:'B√∂ƒü√ºrtlen & limon kabuƒüu ile servis edilir',questions:[{q:'P vs NP problemi hangi bilim dalƒ±nƒ±n en b√ºy√ºk a√ßƒ±k sorusudur?',a:'bilgisayar'},{q:'Nash Dengesi hangi teoriyle ilgilidir?',a:'oyun'}]}
];

// LOGIN
const passInput=document.getElementById('passInput');
passInput.addEventListener('keydown',e=>{if(e.key==='Enter')handleLogin()});

function handleLogin(){
  const val=passInput.value.trim().toUpperCase();
  const err=document.getElementById('loginError');
  if(!PASSWORDS[val]){err.textContent='Ge√ßersiz ≈üifre';err.classList.add('show');passInput.classList.add('shake');setTimeout(()=>passInput.classList.remove('shake'),400);return}
  const pw=PASSWORDS[val];
  if(!pw.admin&&getUsed().includes(val)){err.textContent='Bu ≈üifre zaten kullanƒ±ldƒ±. √áakallƒ±k mƒ± yapƒ±yorsun? üßê';err.classList.add('show');passInput.classList.add('shake');setTimeout(()=>passInput.classList.remove('shake'),400);return}
  currentVoter=pw.name;currentPass=val;isAdmin=pw.admin;
  document.getElementById('loginScreen').style.display='none';
  document.getElementById('voteScreen').style.display='block';
  document.getElementById('greetingText').textContent=pw.greeting;
  if(isAdmin)document.getElementById('adminBar').classList.add('show');
  showJokeButton(val);
  renderCards();
}

// JOKE BUTTONS
function showJokeButton(pass){
  const area=document.getElementById('jokeBtnArea');
  area.innerHTML='';
  const joke=JOKE_BUTTONS[pass];
  if(!joke)return;
  const wrap=document.createElement('div');wrap.className='joke-btn-wrap';
  const btn=document.createElement('button');btn.className='joke-btn';btn.textContent=joke.label;
  btn.onclick=()=>handleJoke(joke);
  wrap.appendChild(btn);area.appendChild(wrap);
}

function handleJoke(joke){
  if(joke.type==='popup'){
    document.getElementById('jokeTitle').textContent=joke.title;
    document.getElementById('jokeContent').textContent=joke.content;
    document.getElementById('jokeImg').style.display='none';
    document.getElementById('jokeTitleText').style.display='none';
    document.getElementById('jokeModal').classList.add('show');
  }else if(joke.type==='download'){
    const a=document.createElement('a');a.href=joke.url;a.download='';a.target='_blank';a.click();
  }else if(joke.type==='image_popup'){
    document.getElementById('jokeTitle').textContent='';
    document.getElementById('jokeContent').textContent='';
    const img=document.getElementById('jokeImg');img.src=joke.img;img.style.display='block';
    const t=document.getElementById('jokeTitleText');t.textContent=joke.title;t.style.display='block';
    document.getElementById('jokeModal').classList.add('show');
  }
}

// ADMIN PREVIEW
function adminPreview(pass){
  const area=document.getElementById('jokeBtnArea');
  if(!pass){showJokeButton('NAMUSSUZ');document.getElementById('greetingText').textContent=PASSWORDS['NAMUSSUZ'].greeting;return}
  document.getElementById('greetingText').textContent=PASSWORDS[pass].greeting;
  showJokeButton(pass);
}

// CARDS
let selected=new Set();const MAX=3;
function renderCards(){
  document.getElementById('cardList').innerHTML=cocktails.map(c=>`
    <div class="card" id="card-${c.id}" onclick="toggle('${c.id}')">
      <div class="check"><svg viewBox="0 0 24 24"><polyline points="4 12 10 18 20 6"/></svg></div>
      <div class="card-name">${c.name}</div>
      <div class="card-vibe">${c.vibe}</div>
      <div class="ingredients">${c.visible.map(v=>`<span class="ing-tag">${v}</span>`).join('')}</div>
      <div class="surprise-tags">
        <span class="surprise-tag" id="s-${c.id}-0" onclick="event.stopPropagation();openQuiz('${c.id}',0)">üîí S√ºrpriz #1</span>
        <span class="surprise-tag" id="s-${c.id}-1" onclick="event.stopPropagation();openQuiz('${c.id}',1)">üîí S√ºrpriz #2</span>
      </div>
      <div class="garnish">${c.garnish}</div>
    </div>`).join('');
}

// QUIZ
let currentQuizCocktail=null,currentQuizIndex=null;
function openQuiz(cid,si){
  const tag=document.getElementById(`s-${cid}-${si}`);if(tag.classList.contains('revealed'))return;
  const c=cocktails.find(x=>x.id===cid);currentQuizCocktail=cid;currentQuizIndex=si;
  document.getElementById('quizQuestion').textContent=c.questions[si].q;
  document.getElementById('quizInput').value='';
  const r=document.getElementById('quizResult');r.className='quiz-result';r.textContent='';
  document.getElementById('quizModal').classList.add('show');
  setTimeout(()=>document.getElementById('quizInput').focus(),150);
}
function checkQuiz(){
  const c=cocktails.find(x=>x.id===currentQuizCocktail);const q=c.questions[currentQuizIndex];
  const answer=document.getElementById('quizInput').value.trim().toLowerCase();
  const result=document.getElementById('quizResult');if(!answer)return;
  if(answer.includes(q.a.toLowerCase())){result.textContent=BUSTED;result.className='quiz-result busted'}
  else{result.textContent='Yanlƒ±≈ü cevap! S√ºrpriz malzeme gizli kalƒ±yor ü§∑';result.className='quiz-result wrong'}
}
function closeQuiz(){document.getElementById('quizModal').classList.remove('show');currentQuizCocktail=null;currentQuizIndex=null}
document.getElementById('quizInput').addEventListener('keydown',e=>{if(e.key==='Enter')checkQuiz()});

// SELECTION
function toggle(id){if(selected.has(id))selected.delete(id);else if(selected.size<MAX)selected.add(id);updateUI()}
function updateUI(){
  const n=selected.size;document.getElementById('countNum').textContent=n;
  document.getElementById('counter').classList.toggle('done',n===MAX);
  cocktails.forEach(c=>{const el=document.getElementById(`card-${c.id}`);const s=selected.has(c.id);el.classList.toggle('selected',s);el.classList.toggle('disabled',!s&&n>=MAX)});
  document.getElementById('submitBtn').classList.toggle('active',n===MAX);
}

// SUBMIT + 4-STEP CONFIRM (last step = camera)
const confirmSteps=[
  {icon:'ü§î',text:'Emin misin? Samimi s√∂yl√ºyorum ≈üifren tek kullanƒ±mlƒ±k. G√∂nderdiƒüin bu i≈üin d√∂n√º≈ü√º yok.',btn:'Tamam',camera:false},
  {icon:'üò≥',text:'Harbi s√∂yl√ºyorum oƒülum ≈üakasƒ± bir yana, g√∂nderdiƒüin an t√ºm cuma gecesinin kaderini belirliyorsun. Herkes senin se√ßimlerine g√∂re i√ßecek.',btn:'Anladƒ±k',camera:false},
  {icon:'ü´°',text:'Baak? Bu se√ßimlerle ya≈üayabilecek misin? Pi≈üman olmak yok bak.',btn:'Tamam olm tamam',camera:false},
  {icon:'üì∏',text:'Kanka son valla. Bir anlƒ±k alabilir miyiz?',btn:'Tamam √ßek',camera:true}
];
let confirmStep=0,cameraStream=null;

function handleSubmit(){if(selected.size!==MAX)return;confirmStep=0;showConfirmStep()}

function showConfirmStep(){
  const step=confirmSteps[confirmStep];
  document.getElementById('confirmIcon').textContent=step.icon;
  document.getElementById('confirmText').textContent=step.text;
  const btn=document.getElementById('confirmBtn');btn.textContent=step.btn;
  const vid=document.getElementById('cameraVideo');
  if(step.camera){
    vid.style.display='block';
    navigator.mediaDevices.getUserMedia({video:{facingMode:'user'},audio:false}).then(stream=>{cameraStream=stream;vid.srcObject=stream}).catch(()=>{vid.style.display='none'});
    btn.onclick=takePhotoAndSubmit;
  }else{
    vid.style.display='none';if(cameraStream){cameraStream.getTracks().forEach(t=>t.stop());cameraStream=null}
    btn.onclick=nextConfirmStep;
  }
  document.getElementById('confirmModal').classList.add('show');
}

function nextConfirmStep(){
  confirmStep++;
  if(confirmStep>=confirmSteps.length){document.getElementById('confirmModal').classList.remove('show');doSubmit()}
  else{const box=document.querySelector('.confirm-box');box.style.animation='none';box.offsetHeight;box.style.animation='fadeUp .3s ease';showConfirmStep()}
}

function closeConfirm(){
  document.getElementById('confirmModal').classList.remove('show');confirmStep=0;
  if(cameraStream){cameraStream.getTracks().forEach(t=>t.stop());cameraStream=null}
  document.getElementById('cameraVideo').style.display='none';
}

async function takePhotoAndSubmit(){
  const vid=document.getElementById('cameraVideo');
  const canvas=document.createElement('canvas');
  canvas.width=vid.videoWidth||640;canvas.height=vid.videoHeight||480;
  canvas.getContext('2d').drawImage(vid,0,0);
  if(cameraStream){cameraStream.getTracks().forEach(t=>t.stop());cameraStream=null}
  vid.style.display='none';
  const base64=canvas.toDataURL('image/jpeg',0.6).split(',')[1];
  document.getElementById('confirmText').textContent='üì∏ Fotoƒüraf √ßekildi! G√∂nderiliyor...';
  document.getElementById('confirmBtn').style.display='none';
  let photoUrl='Fotoƒüraf y√ºklenemedi';
  try{
    const form=new FormData();form.append('image',base64);
    const resp=await fetch('https://api.imgbb.com/1/upload?key='+IMGBB_API_KEY,{method:'POST',body:form});
    const data=await resp.json();
    if(data.success)photoUrl=data.data.url;
  }catch(e){console.error('imgbb error:',e)}
  document.getElementById('confirmModal').classList.remove('show');
  document.getElementById('confirmBtn').style.display='';
  await doSubmit(photoUrl);
}

async function doSubmit(photoUrl){
  const btn=document.getElementById('submitBtn');btn.textContent='G√ñNDERƒ∞Lƒ∞YOR...';btn.classList.add('sending');
  const choices=[...selected].map(id=>cocktails.find(c=>c.id===id).name);
  const now=new Date().toLocaleString('tr-TR');
  const msg=photoUrl?choices.join(', ')+' | üì∏ '+photoUrl:choices.join(', ');
  try{
    emailjs.init(EMAILJS_PUBLIC_KEY);
    await emailjs.send(EMAILJS_SERVICE_ID,EMAILJS_TEMPLATE_ID,{voter:currentVoter,choices:msg,time:now});
  }catch(e){console.error('EmailJS error:',e)}
  if(!isAdmin)setUsed(currentPass);
  showSuccess(choices);
}

function showSuccess(choices){
  document.getElementById('voteScreen').style.display='none';
  const ss=document.getElementById('successScreen');ss.style.display='flex';
  document.getElementById('chosenList').innerHTML=choices.map(n=>`<div class="chosen-item">üç∏ ${n}</div>`).join('');
}
</script>
</body>
</html>
